# 目录工具



## 遍历目录

### 用`os.popen`运行*shell*列表命令

在*Unix*下，我们通常在*shell*中键入`ls`来获取目录列表：

```python
beacherhou@alone-Vostro-14-5401:/media/beacherhou/Coding/code_obsidian_知识库/Python编程_Markdown笔记$ ls
第二部分_系统编程  jupyter  LICENSE  pp4e  PP4E-Examples-1.4  README.md
beacherhou@alone-Vostro-14-5401:/media/beacherhou/Coding/code_obsidian_知识库/Python编程_Markdown笔记$ ls -a
.  ..  第二部分_系统编程  .git  .gitignore  jupyter  LICENSE  pp4e  PP4E-Examples-1.4  README.md
```

脚本就可以在内部运行*shell*命令来获取文件和目录名称：

```python
# 使用readlines方法
>>> os.popen('ls').readlines()
['第二部分_系统编程\n', 'jupyter\n', 'LICENSE\n', 'pp4e\n', 'PP4E-Examples-1.4\n', 'README.md\n']

# 使用行迭代器
>>> for line_str in os.popen('ls'):
...     print(line_str[:-1])
... 
第二部分_系统编程
jupyter
LICENSE
pp4e
PP4E-Examples-1.4
README.md
>>> list(os.popen('ls'))
['第二部分_系统编程\n', 'jupyter\n', 'LICENSE\n', 'pp4e\n', 'PP4E-Examples-1.4\n', 'README.md\n']

# 使用列表解析
>>> [fn_str for fn_str in os.popen('ls')]
['第二部分_系统编程\n', 'jupyter\n', 'LICENSE\n', 'pp4e\n', 'PP4E-Examples-1.4\n', 'README.md\n']
```

如前所述，`os.popen`的缺点是可移植性差，且需启动一个独立进程，降低性能。

### `glob`模块

`glob`意味着收集一个目录（包括文件和子目录）中所有通道的名称，而且目录的名称要符合给定的文件名模式。我们可以调用`glob.glob`内建函数，它接受文件名模式拓展，并返回一个匹配文件名所组成的列表（而非生成器）：

```python
>>> import glob
>>> glob.glob('*')
['jupyter', 'LICENSE', 'pp4e', 'PP4E-Examples-1.4', 'README.md', '第二部分_系统编程']
>>> glob.glob('*[Ee]*')
['jupyter', 'LICENSE', 'pp4e', 'PP4E-Examples-1.4', 'README.md']
>>> glob.glob('*p?t*')
['jupyter']
>>> glob.glob('*.md')
['README.md']
>>> glob.glob('pp4e/system/*.txt')
['pp4e/system/data.txt', 'pp4e/system/hello_in.txt', 'pp4e/system/hillbillies.txt', 'pp4e/system/input.txt', 'pp4e/system/output.txt', 'pp4e/system/spam.txt', 'pp4e/system/test.txt']
```

- `glob`调用接受*shell*中常用文件名模式语法：`?`代表任意单个字符，`*`代表任意个字符，`[]`括起来的是字符串选集。如果想匹配其他目录，那么在模式中还应包括一个目录路径。
- `glob.glob`调用没有用到*shell*命令，因此可以移植到所有主流的*Python*平台。

`glob`有很多用途。例如，它还可以用于多个目录下收集匹配名称：

```python
>>> glob.glob('P*/E*/P*/*/s*.py')
['PP4E-Examples-1.4/Examples/PP4E/Lang/summer.py', 'PP4E-Examples-1.4/Examples/PP4E/Lang/summer2.py', 'PP4E-Examples-1.4/Examples/PP4E/Lang/summer3.py', 'PP4E-Examples-1.4/Examples/PP4E/Tools/search_all.py']
```

### `os.listdir`调用

`os.listdir`返回一个包含该目录中所有条目名称的列表：

```python
>>> import os
>>> 
>>> os.listdir('.')
['.git', '.gitignore', 'jupyter', 'LICENSE', 'pp4e', 'PP4E-Examples-1.4', 'README.md', '第二部分_系统编程']
>>> os.listdir(os.curdir)
['.git', '.gitignore', 'jupyter', 'LICENSE', 'pp4e', 'PP4E-Examples-1.4', 'README.md', '第二部分_系统编程']
>>> os.listdir('PP4E*')
Traceback (most recent call last):
  File "<stdin>", line 1, in <module>
FileNotFoundError: [Errno 2] No such file or directory: 'PP4E*'
>>> os.listdir('PP4E-Examples-1.4')
['changes', 'CHANGES.txt', 'Examples', 'extensions', 'README-PP4E-PY33.html', 'README.txt']
```

- 这个调用也没有用到*shell*命令，因此可以移植到*Python*支持的所有主流平台。
- `os.listdir`返回的结果没有刻意的排序。
- 返回的是不带目录路径前缀的文件（目录）名。

### 分割与合并列举结果

为方便处理，脚本通常将`glob`返回的结果分割为基本文件（或目录）名，将`os.listdir`返回的结果拓展为完整路径。

```python
# 将glob返回的结果分割为基本文件（或目录）名
>>> import glob
>>> 
>>> 
>>> cwd_str = os.getdir()
Traceback (most recent call last):
  File "<stdin>", line 1, in <module>
AttributeError: module 'os' has no attribute 'getdir'
>>> cwd_str = os.getcwd()
>>> cwd_dir
Traceback (most recent call last):
  File "<stdin>", line 1, in <module>
NameError: name 'cwd_dir' is not defined
>>> cwd_str
'/media/beacherhou/Coding/code_obsidian_知识库/Python编程_Markdown笔记'
>>> 
>>> for i_file_str in glob.glob(cwd_str + '/*'):
...     head, tail = os.path.split(i_file_str)
...     print(i_file_str, '=>', 'head', head, 'tail', tail)
... 
/media/beacherhou/Coding/code_obsidian_知识库/Python编程_Markdown笔记/jupyter => head /media/beacherhou/Coding/code_obsidian_知识库/Python编程_Markdown笔记 tail jupyter
/media/beacherhou/Coding/code_obsidian_知识库/Python编程_Markdown笔记/LICENSE => head /media/beacherhou/Coding/code_obsidian_知识库/Python编程_Markdown笔记 tail LICENSE
/media/beacherhou/Coding/code_obsidian_知识库/Python编程_Markdown笔记/pp4e => head /media/beacherhou/Coding/code_obsidian_知识库/Python编程_Markdown笔记 tail pp4e
/media/beacherhou/Coding/code_obsidian_知识库/Python编程_Markdown笔记/PP4E-Examples-1.4 => head /media/beacherhou/Coding/code_obsidian_知识库/Python编程_Markdown笔记 tail PP4E-Examples-1.4
/media/beacherhou/Coding/code_obsidian_知识库/Python编程_Markdown笔记/README.md => head /media/beacherhou/Coding/code_obsidian_知识库/Python编程_Markdown笔记 tail README.md
/media/beacherhou/Coding/code_obsidian_知识库/Python编程_Markdown笔记/第二部分_系统编程 => head /media/beacherhou/Coding/code_obsidian_知识库/Python编程_Markdown笔记 tail 第二部分_系统编程

# 将os.listdir返回的结果拓展为完整路径
>>> import os
>>> 
>>> 
>>> for i_file_str in os.listdir(cwd_str):
...     print(cwd_str, i_file_str, '=>', os.path.join(cwd_str, i_file_str))
... 
/media/beacherhou/Coding/code_obsidian_知识库/Python编程_Markdown笔记 .git => /media/beacherhou/Coding/code_obsidian_知识库/Python编程_Markdown笔记/.git
/media/beacherhou/Coding/code_obsidian_知识库/Python编程_Markdown笔记 .gitignore => /media/beacherhou/Coding/code_obsidian_知识库/Python编程_Markdown笔记/.gitignore
/media/beacherhou/Coding/code_obsidian_知识库/Python编程_Markdown笔记 jupyter => /media/beacherhou/Coding/code_obsidian_知识库/Python编程_Markdown笔记/jupyter
/media/beacherhou/Coding/code_obsidian_知识库/Python编程_Markdown笔记 LICENSE => /media/beacherhou/Coding/code_obsidian_知识库/Python编程_Markdown笔记/LICENSE
/media/beacherhou/Coding/code_obsidian_知识库/Python编程_Markdown笔记 pp4e => /media/beacherhou/Coding/code_obsidian_知识库/Python编程_Markdown笔记/pp4e
/media/beacherhou/Coding/code_obsidian_知识库/Python编程_Markdown笔记 PP4E-Examples-1.4 => /media/beacherhou/Coding/code_obsidian_知识库/Python编程_Markdown笔记/PP4E-Examples-1.4
/media/beacherhou/Coding/code_obsidian_知识库/Python编程_Markdown笔记 README.md => /media/beacherhou/Coding/code_obsidian_知识库/Python编程_Markdown笔记/README.md
/media/beacherhou/Coding/code_obsidian_知识库/Python编程_Markdown笔记 第二部分_系统编程 => /media/beacherhou/Coding/code_obsidian_知识库/Python编程_Markdown笔记/第二部分_系统编程
```

